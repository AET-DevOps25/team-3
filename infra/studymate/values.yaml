# This file contains the default values for the studymate App Helm chart.

teamid: team-3

# Auth Service - Authentication microservice
authService:
  image:
    repository: ghcr.io/aet-devops25/team-3/auth-service
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 8086  # Changed from 8083 to avoid conflict with weaviate
    targetPort: 8083
  replicaCount: 1
  env:
    - name: SPRING_PROFILES_ACTIVE
      value: docker
    - name: SPRING_DATASOURCE_URL
      value: "jdbc:postgresql://studymate-postgres:5432/auth_db"
    - name: SPRING_DATASOURCE_USERNAME
      valueFrom:
        secretKeyRef:
          name: postgres-secret
          key: username
    - name: SPRING_DATASOURCE_PASSWORD
      valueFrom:
        secretKeyRef:
          name: postgres-secret
          key: password
    - name: JWT_SECRET
      valueFrom:
        secretKeyRef:
          name: auth-secret
          key: jwt-secret
    - name: JWT_EXPIRATION
      value: "86400000"
    - name: JWT_REFRESH_EXPIRATION
      value: "604800000"

# Document Service - Document management microservice
documentService:
  image:
    repository: ghcr.io/aet-devops25/team-3/document-service
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 8084
    targetPort: 8084
  replicaCount: 1
  env:
    - name: SPRING_PROFILES_ACTIVE
      value: docker
    - name: SPRING_DATASOURCE_URL
      value: "jdbc:postgresql://studymate-postgres:5432/document_db"
    - name: SPRING_DATASOURCE_USERNAME
      valueFrom:
        secretKeyRef:
          name: postgres-secret
          key: username
    - name: SPRING_DATASOURCE_PASSWORD
      valueFrom:
        secretKeyRef:
          name: postgres-secret
          key: password
    - name: JWT_SECRET
      valueFrom:
        secretKeyRef:
          name: auth-secret
          key: jwt-secret
    - name: AUTH_SERVICE_URL
      value: "http://{{ include \"studymate.fullname\" . }}-auth-service:8086"
    - name: SPRING_SERVLET_MULTIPART_MAX_FILE_SIZE
      value: "50MB"
    - name: SPRING_SERVLET_MULTIPART_MAX_REQUEST_SIZE
      value: "100MB"

# GenAI Service - GenAI orchestration microservice (Kotlin)
genaiService:
  image:
    repository: ghcr.io/aet-devops25/team-3/genai-service
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 8085
    targetPort: 8085
  replicaCount: 1
  env:
    - name: SPRING_PROFILES_ACTIVE
      value: docker
    - name: JWT_SECRET
      valueFrom:
        secretKeyRef:
          name: auth-secret
          key: jwt-secret
    - name: AUTH_SERVICE_URL
      value: "http://{{ include \"studymate.fullname\" . }}-auth-service:8086"
    - name: DOCUMENT_SERVICE_URL
      value: "http://{{ include \"studymate.fullname\" . }}-document-service:8084"
    - name: GENAI_BACKEND_URL
      value: "http://{{ include \"studymate.fullname\" . }}-genai:8081"
    - name: RATE_LIMIT_REQUESTS_PER_MINUTE
      value: "60"
    - name: SERVER_TOMCAT_THREADS_MAX
      value: "200"

server:
  image:
    repository: ghcr.io/aet-devops25/team-3/server
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 8082
    targetPort: 8082
  replicaCount: 1
  env:
    - name: SPRING_PROFILES_ACTIVE
      value: docker
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: server-secret
          key: database-url
    - name: SPRING_DATASOURCE_URL
      value: "jdbc:postgresql://studymate-postgres:5432/mydb"
    - name: SPRING_DATASOURCE_USERNAME
      valueFrom:
        secretKeyRef:
          name: postgres-secret
          key: username
    - name: SPRING_DATASOURCE_PASSWORD
      valueFrom:
        secretKeyRef:
          name: postgres-secret
          key: password
    - name: SPRING_JPA_HIBERNATE_DDL_AUTO
      value: "update"
    - name: SPRING_JPA_SHOW_SQL
      value: "false"
    - name: JAVA_OPTS
      value: "-Xmx768m -Xms512m -XX:+UseG1GC -XX:MaxGCPauseMillis=200"
    - name: JWT_SECRET
      valueFrom:
        secretKeyRef:
          name: server-secret
          key: jwt-secret

client:
  image:
    repository: ghcr.io/aet-devops25/team-3/client
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  replicaCount: 1

genAi:
  image:
    repository: ghcr.io/aet-devops25/team-3/genai
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 8081
    targetPort: 8081
  replicaCount: 1
  env:
    - name: OPENAI_API_KEY
      valueFrom:
        secretKeyRef:
          name: genai-secret
          key: api-key
    - name: OPEN_WEBUI_API_KEY_CHAT
      valueFrom:
        secretKeyRef:
          name: genai-secret
          key: open-webui-api-key-chat
    - name: OPEN_WEBUI_API_KEY_GEN
      valueFrom:
        secretKeyRef:
          name: genai-secret
          key: open-webui-api-key-gen
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: server-secret
          key: database-url
    - name: WEAVIATE_HOST
      value: "{{ include \"studymate.fullname\" . }}-weaviate"
    - name: WEAVIATE_PORT
      value: "8083"

postgres:
  image:
    repository: postgres
    tag: "15"
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 5432
    targetPort: 5432
  replicaCount: 1
  persistence:
    size: 8Gi
    storageClass: ""  # Use default storage class
  env:
    - name: POSTGRES_USER
      valueFrom:
        secretKeyRef:
          name: postgres-secret
          key: username
    - name: POSTGRES_PASSWORD
      valueFrom:
        secretKeyRef:
          name: postgres-secret
          key: password
    - name: POSTGRES_DB
      value: mydb

weaviate:
  image:
    repository: cr.weaviate.io/semitechnologies/weaviate
    tag: "1.30.3"
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8083
    targetPort: 8080
  replicaCount: 1
  persistence:
    size: 10Gi
    storageClass: ""  # Use default storage class
  env:
    - name: QUERY_DEFAULTS_LIMIT
      value: "25"
    - name: AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED
      value: "true"
    - name: PERSISTENCE_DATA_PATH
      value: "/var/lib/weaviate"
    - name: ENABLE_API_BASED_MODULES
      value: "true"
    - name: CLUSTER_HOSTNAME
      value: "node1"
    - name: HTTP_PORT
      value: "8083"
    - name: GRPC_PORT
      value: "50051"

ingress:
  enabled: true
  className: "nginx"
  tls: true
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"

# Secret management configuration
secrets:
  postgres:
    create: true
    name: postgres-secret
    # Use external secret management or set via --set-string
    # Never commit actual secret values to version control
    existingSecret: ""  # Name of existing secret to use instead of creating new one
    data:
      username: postgres
      password: null  # REQUIRED: Set via --set-string secrets.postgres.data.password=<value>

  # Auth service secrets (shared JWT secret)
  auth:
    create: true
    name: auth-secret
    existingSecret: ""  # Name of existing secret to use instead of creating new one
    data:
      jwtSecret: null  # REQUIRED: Set via --set-string secrets.auth.data.jwtSecret=<value>

  genai:
    create: true
    name: genai-secret
    existingSecret: ""  # Name of existing secret to use instead of creating new one
    data:
      apiKey: null  # REQUIRED: Set via --set-string secrets.genai.data.apiKey=<value>
      openWebUiApiKeyChat: null  # REQUIRED: Set via --set-string secrets.genai.data.openWebUiApiKeyChat=<value>
      openWebUiApiKeyGen: null  # REQUIRED: Set via --set-string secrets.genai.data.openWebUiApiKeyGen=<value>
      
  server:
    create: true  
    name: server-secret
    existingSecret: ""  # Name of existing secret to use instead of creating new one
    data:
      jwtSecret: null  # REQUIRED: Set via --set-string secrets.server.data.jwtSecret=<value>
      databaseUrl: null  # REQUIRED: Set via --set-string secrets.server.data.databaseUrl=<value>